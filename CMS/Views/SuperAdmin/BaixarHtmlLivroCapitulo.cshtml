@model business.business.Pagina

@{
    ViewBag.Title = "Create";
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

<div class="form-horizontal">
    <h4>Importar Capitulo de livro</h4>
    <hr />
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

     <div class="form-group">    
        <label  class="control-label">Capitulo</label>
            @Html.DropDownList("cap", null, htmlAttributes: new { @class = "form-control" })      
    </div>    

    <div class="form-group">
                <label  class="control-label">Livro</label>
                <input id="livro" name="livro" class="form-control" type="url">
            </div>
            <div id="listaUrls" style="position:absolute; display:none; z-index:2000;" class="jumbotron">

            </div>

            <div class="form-group">
                <label  class="control-label">Capitulo do livro:</label>
                <input id="capitulo" name="capitulo" class="form-control" type="number" >
            </div>           

            <div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                    <input type="submit" value="Importar" class="btn btn-default" />
                </div>
            </div>

</div>
}



@section Scripts {

    <script type="text/javascript">

             function buscarLivro(url)
            {
                document.getElementById("livro").value = url;
                 $("#listaUrls").css("display", "none");
            }         

</script>
    
<script type="text/javascript">
        $(document).ready(function () {

            
            
            $("#livro").keyup(function(){   
         

                 $.ajax({
                    type: 'POST',
                    url: '/AjaxGet/BuscarLivros',
                    dataType: 'json',
                    data: { valor: $(this).val() },
                    success: function (data) {

                        if (data == null)
                            $("#listaUrls").css("display", "none");
                        else
                            $("#listaUrls").css("display", "block");
                        $("#listaUrls").empty();
                        $.each(data, function (i) {
                            
                            $("#listaUrls").append("<p>" +
                             "<a href='#' onclick=" + "\"buscarLivro('"+data[i].url+"');\" >" +
                                data[i].url +
                                "</a></p> <br>");
                                              
                        });
                    },
                    error: function (ex) {
                        alert('Falha ao buscar urls.' + ex);
                    }
                });

            });

             

        });
</script>

}
